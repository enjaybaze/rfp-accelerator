<div class="review_document_container">
  <!-- Title and steps section -->
  <div class="title_container">
    <div class="content_title">
      <div class="content_title_line1">
        <p><b>Home / Create new RFP /</b></p>
      </div>
      <div class="content_title_line2">
        <p>Review Model Responses - <span><b>{{this.responseCompletion}}</b></span> % Completed in <b>{{this.timerCompletion}}</b> (MM:SS)</p>
        <!-- Review Model Responses - 100 % Completed in 01:08 mins -->
      </div>
    </div>
  </div>
  <!-- ... Your existing title and steps section ... -->
  <div class="md-stepper-horizontal">
    <div class="md-step active">
      <div class="md-step-circle">
        <span><img src="assets/checked-widget.svg" alt="Upload RFP" width="25" height="25" /></span>
      </div>
      <div class="md-step-title">Upload RFP</div>
      <div class="md-step-bar-left"></div>
      <div class="md-step-bar-right"></div>
    </div>
    <div class="md-step active">
      <div class="md-step-circle">
        <span><img src="assets/checked-widget.svg" alt="Preview Questions" width="25" height="25" /></span>
      </div>
      <div class="md-step-title">Preview Questions</div>
      <div class="md-step-bar-left"></div>
      <div class="md-step-bar-right"></div>
    </div>
    <div class="md-step active">
      <div class="md-step-circle">
        <span><img src="assets/review-model-response.svg" alt="Review Model Response" width="25" height="25" /></span>
      </div>
      <div class="md-step-title">Review Model Response</div>
      <div class="md-step-bar-left"></div>
      <div class="md-step-bar-right"></div>
    </div>
  </div>

  <div class="PAReview">
    <!-- Tabs and table section -->
    <div class="radibtn">
      <!-- Tab buttons -->
      <div class="tabsseadiv">
        <div class="tabs_container">
          <div class="dynamic_tabs" *ngFor="let item of responseData; let i = index">
            <button mat-button (click)="tabChanged(i)" [class.active]="i === activeTabIndex">
              {{ item.page_name}} <span class="btnradactiv" [class.active]="i === activeTabIndex">
                {{responseData[i].data.length}}</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Table with model responses -->
    <mat-card>
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort matPaginator>
        <!-- Columns definition -->
        <ng-container matColumnDef="sNo">
          <!-- S.No. column -->
          <th class="tableCellQunes" mat-header-cell *matHeaderCellDef> <b>S.No.</b></th>
          <td class="tableCellQun text" mat-cell *matCellDef="let element; let i = index" [ngClass]="{
              'editedWhite': element.isSaveResponse,
              'edited': element.runModelStatus,
              'editedInline': element.isEdited
            }">
            {{ i + 1 + (paginator?.pageIndex || 0) * pageSize }}
          </td>
        </ng-container>
        <ng-container matColumnDef="question">
          <!-- Question column -->
          <th class="Question" mat-header-cell *matHeaderCellDef> <b>Question</b> </th>
          <td class="Question1 text" mat-cell *matCellDef="let element">{{ element.question }}</td>
        </ng-container>
        <ng-container matColumnDef="searchRefinement">
          <!-- Search Refinement column -->
          <th class="Refinement" mat-header-cell *matHeaderCellDef> <b>Search Refinement</b> </th>
          <td class="Refinement1 text" mat-cell *matCellDef="let element">{{ element.search_refinement }}</td>
        </ng-container>
        <ng-container matColumnDef="rfpAcceleratorResponse">
          <!-- Model Response column -->
          <th class="modelResponse" mat-header-cell *matHeaderCellDef="let element; let i = index">
            <b>Model Response</b>
            <button mat-raised-button (click)="toggleAll()" style="box-shadow: none;background-color: #D3E3FD;left:45%;color: #322f2f;
            font-size: 16px;font-weight: bold;font-family: 'Google Sans';">
              {{ allRowsExpanded ? 'Collapse All' : 'Expand All'}}
              <img src="{{ allRowsExpanded ? collapse : expand}}" width="18" height="18" class="icon_position">
            </button>
          </th>
          <td class="modelResponse1 text" mat-cell *matCellDef="let element; let i = index">
            <ng-container
              *ngIf="element.rfpAcceleratorResponse !== 'waiting' && element.rfpAcceleratorResponse !== undefined">
              <table class="model_test_fit">
                <tr>
                  <td class="model_response_box">
                    {{
                    showHide[i] ? element.rfpAcceleratorResponse :
                        (element.rfpAcceleratorResponse.length > 190 ?
                        (element.rfpAcceleratorResponse | slice: 0:190) + '...' :
                    element.rfpAcceleratorResponse)
                    }}
                  </td>
                  <td>
                    <a class="showMore" type="button"
                      *ngIf="element.rfpAcceleratorResponse && element.rfpAcceleratorResponse.length > 190;"
                      (click)="toggle(i);$event.stopPropagation()">
                      <img src="{{ showHide[i] ? showLess : showMore }}" width="32px" height="32px" class="icon_position_Expand">
                    </a>
                    <a class="fit_text" 
                      *ngIf="element.rfpAcceleratorResponse && element.rfpAcceleratorResponse.length < 190;"
                      > </a>
                  </td>
                </tr>
              </table>
            </ng-container>
            <ng-container
              *ngIf="element.rfpAcceleratorResponse === 'waiting' || element.rfpAcceleratorResponse === undefined">
              <div class="no_response">
                <div class="linear-gradient large"></div>
                <div class="linear-gradient small"></div>
              </div>
            </ng-container>
          </td>
        </ng-container>
        <ng-container matColumnDef="feedback">
          <!-- Feedback column -->
          <th class="feedback" mat-header-cell *matHeaderCellDef></th>
          <td class="feedback1" mat-cell *matCellDef="let element">
            <ng-container *ngIf="responseCompletion >= 100">
              <!-- Show enabled feedback button -->
              <ng-container *ngIf="element.pa_feedback === '' || element.pa_feedback === null">
                <button mat-icon-button (click)="openRfpFeedbackPopup(element.id)">
                  <img src="/assets/feedback-icon.svg" alt="Feedback Icon" width="18" height="18" class="icon_position">
                </button>
              </ng-container>
              <ng-container *ngIf="element.pa_feedback !== '' && element.pa_feedback !== null">
                <button mat-icon-button (click)="openRfpFeedbackPopup(element.id)" class="feedback-button">
                  <span class="feedback_container">
                    <img src="/assets/feedback-update-icon.svg" alt="Feedback Icon" class="feedback_updated_position">
                  </span>
                  <img src="/assets/feedback-icon.svg" alt="Feedback Icon" width="18" height="18" class="icon_position">
                </button>
              </ng-container>
            </ng-container>
            <ng-container *ngIf="responseCompletion < 100 || responseCompletion === undefined">
              <!-- Show disabled feedback button -->
              <button mat-icon-button [disabled]="true" style="opacity: 0.38;">
                <img src="/assets/feedback-icon.svg" alt="Feedback Icon" width="18" height="18" class="icon_position">
              </button>
            </ng-container>
          </td>

        </ng-container>

        <!-- Header and row definitions -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <!-- Pagination -->
      <div class="table_pagination">
        <mat-paginator class="demo-paginator" (page)="onPageChange($event)" [pageSize]="pageSize" [disabled]="disabled"
          [showFirstLastButtons]="showFirstLastButtons" [pageSizeOptions]="pageSizeOptions" aria-label="Select page">
        </mat-paginator>
      </div>
    </mat-card>

    <!-- Save and Export buttons -->
    <div class="button_container">
      
      <button mat-fab extended class="review_buttons" (click)="downloadResponses()"
        [style.background-color]="!responseCompleted?'rgba(31, 31, 31, 0.12)':'#0B57D0'"
        [disabled]="!responseCompleted">
        <span class="button_text" style="color:white;"><img src="assets/export-button.svg" width="18" height="18"
            class="icon_position" /> <b>Export to sheets</b></span>
      </button>
    </div>

    <!-- Loading spinner -->
    <div *ngIf="loading" class="overlay">
      <div class="spinner-3"></div>
    </div>
    <div *ngIf="showSpinner" class="overlayButton">
      <div class="spinner-3"></div>
    </div>
  </div>
</div>